<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>项目管理系统</title>
    <link rel="stylesheet" href="../static/layui/css/layui.css">
    <link rel="stylesheet" href="../static/css/initial.css">
    <link rel="stylesheet" href="../static/css/admin/index.css">
</head>
<div id="add-project"
     style="display:none;">
    <div class="add-project-wrappper">
        <form class="layui-form" action="insertProject" method="post">

            <input type="hidden" name="userId" id="add-project-userId">

            <div class="layui-form-item">
                <label class="layui-form-label">项目名称</label>
                <div class="layui-input-block">
                    <input type="text" name="projectName" required lay-verify="required" placeholder="请输入项目名称"
                           autocomplete="off"
                           class="layui-input">
                </div>
            </div>


            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">项目内容</label>
                <div class="layui-input-block">
                    <textarea name="content" placeholder="请输入项目内容" class="layui-textarea"></textarea>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">总金额</label>
                <div class="layui-input-block">
                    <input type="text" lay-verify="number" name="totalMoney" placeholder="请输入总金额"
                           autocomplete="off"
                           class="layui-input">
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">负责人</label>
                <div class="layui-input-block">
                    <input type="text" name="leader" placeholder="请输入负责人"
                           autocomplete="off"
                           class="layui-input">
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">时间</label>
                <div class="layui-input-block">
                    <div class="layui-col-md6">
                        <input type="text" name="planStartTime" placeholder="计划开始时间"
                               autocomplete="off"
                               class="layui-input"
                               id="add-plan-start-time">
                    </div>
                    <div class="layui-col-md6">
                        <input type="text" name="planEndTime" placeholder="计划结束时间"
                               autocomplete="off"
                               class="layui-input"
                               id="add-plan-end-time">
                    </div>
                </div>
            </div>


            <div class="layui-form-item">
                <label class="layui-form-label">状态</label>
                <div class="layui-input-block">
                    <select name="status">
                        <option value=""></option>
                        <option value="1">未开始</option>
                        <option value="2">进行中</option>
                        <option value="3">已完成</option>
                    </select>
                </div>
            </div>


            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button class="layui-btn" lay-submit lay-filter="formDemo">立即提交</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>
        </form>

    </div>
</div>

<div id="edit-project"
     style="display:none;">
    <div class="add-project-wrappper">
        <form class="layui-form" action="updateProject" method="post">

            <div class="layui-form-item">
                <label class="layui-form-label">项目名称</label>
                <div class="layui-input-block">
                    <input type="text" name="projectName" required lay-verify="required" placeholder="请输入项目名称"
                           autocomplete="off"
                           class="layui-input">
                </div>
            </div>


            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">项目内容</label>
                <div class="layui-input-block">
                    <textarea name="content" placeholder="请输入项目内容" class="layui-textarea"></textarea>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">总金额</label>
                <div class="layui-input-block">
                    <input type="text" name="totalMoney" placeholder="请输入总金额"
                           autocomplete="off"
                           class="layui-input">
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">负责人</label>
                <div class="layui-input-block">
                    <input type="text" name="leader" placeholder="请输入负责人"
                           autocomplete="off"
                           class="layui-input">
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">时间</label>
                <div class="layui-input-block">
                    <div class="layui-col-md6">
                        <input type="text" name="planStartTime" placeholder="计划开始时间"
                               autocomplete="off"
                               class="layui-input"
                               id="edit-plan-start-time">
                    </div>
                    <div class="layui-col-md6">
                        <input type="text" name="planEndTime" placeholder="计划结束时间"
                               autocomplete="off"
                               class="layui-input"
                               id="edit-plan-end-time">
                    </div>
                </div>
            </div>


            <div class="layui-form-item">
                <label class="layui-form-label">状态</label>
                <div class="layui-input-block">
                    <select name="status">
                        <option value=""></option>
                        <option value="未开始">未开始</option>
                        <option value="进行中">进行中</option>
                        <option value="已完成">已完成</option>
                    </select>
                </div>
            </div>


            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button class="layui-btn" lay-submit lay-filter="formDemo">立即提交</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>
        </form>

    </div>
</div>

<div id="view-project"
     style="display:none;">
    <div class="view-project-wrappper" style="padding: 12px;">
        <div class="" style="padding: 10px 15px;
            font-weight: bold;
            border: 1px solid #c9ced1;
            border-bottom: none;">基本信息
        </div>

        <table class="layui-table base-info-table" style="position: relative;top: -10px;">
            <colgroup>
                <col width="120px">
                <col>
                <col width="120px">
                <col>
            </colgroup>
            <tbody>

            </tbody>
        </table>

    </div>
</div>

<div id="addUser"
     style="display:none;">
    <div class="add-user-wrappper">
        <form class="layui-form" action="insertUser" method="post">

            <div class="layui-form-item">
                <label class="layui-form-label">头像</label>
                <div class="layui-input-block">
                    <button type="button" class="layui-btn layui-btn-sm" id="head-portrait-upload">
                        <i class="layui-icon layui-icon-upload"></i>上传头像
                    </button>
                    <input type="hidden" name="headPortrait" value="" id="head-portrait-input">
                    <img id="head-portrait" class="layui-anim-scaleSpring" src="" alt="头像"/>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">用户名</label>
                <div class="layui-input-block">
                    <input type="text" name="username" required lay-verify="required" placeholder="请输入用户名"
                           autocomplete="off"
                           class="layui-input">
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">手机号码</label>
                <div class="layui-input-block">
                    <input type="text" name="phone" placeholder="请输入手机号码"
                           autocomplete="off"
                           class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">城市</label>
                <div class="layui-input-block">
                    <select name="city">
                        <option value=""></option>
                        <option value="北京">北京</option>
                        <option value="上海">上海</option>
                        <option value="广州">广州</option>
                        <option value="深圳">深圳</option>
                        <option value="杭州">杭州</option>
                    </select>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">兴趣</label>
                <div class="layui-input-block">
                    <input type="checkbox" name="interest[code]" title="编程" checked>
                    <input type="checkbox" name="interest[read]" title="读书">
                    <input type="checkbox" name="interest[sport]" title="运动">
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">性别</label>
                <div class="layui-input-block">
                    <input type="radio" name="sex" value="1" title="男" checked>
                    <input type="radio" name="sex" value="2" title="女">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">管理员</label>
                <div class="layui-input-block">
                    <input type="checkbox" name="isAdmin" lay-skin="switch">
                </div>
            </div>
            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">个性签名</label>
                <div class="layui-input-block">
                    <textarea name="personalizedSignature" placeholder="请输入内容" class="layui-textarea"></textarea>
                </div>
            </div>


            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button class="layui-btn" lay-submit lay-filter="formDemo">立即提交</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>
        </form>

    </div>
</div>
<div id="editUser"
     style="display:none;">
    <div class="edit-user-wrappper">
        <form class="layui-form" action="updateUser">

            <div class="layui-form-item">
                <label class="layui-form-label">头像</label>
                <div class="layui-input-block">
                    <button type="button" class="layui-btn layui-btn-sm" id="edit-head-portrait-upload">
                        <i class="layui-icon layui-icon-upload"></i>上传头像
                    </button>
                    <input type="hidden" name="headPortrait" value="" id="edit-head-portrait-input">
                    <img id="edit-head-portrait" class="layui-anim-scaleSpring" src="" alt="头像"/>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">用户名</label>
                <div class="layui-input-block">
                    <input id="edit-username" type="text" name="username" required lay-verify="required"
                           placeholder="请输入用户名"
                           autocomplete="off"
                           class="layui-input">
                </div>
            </div>
            <input type="hidden" name="password" id="edit-password">
            <div class="layui-form-item">
                <label class="layui-form-label">手机号码</label>
                <div class="layui-input-block">
                    <input type="text" name="phone" placeholder="请输入手机号码"
                           autocomplete="off"
                           id="edit-phone"
                           class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">城市</label>
                <div class="layui-input-block">
                    <select name="city" id="edit-city">
                        <option value=""></option>
                        <option value="北京">北京</option>
                        <option value="上海">上海</option>
                        <option value="广州">广州</option>
                        <option value="深圳">深圳</option>
                        <option value="杭州">杭州</option>
                    </select>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label" id="edit-interest">兴趣</label>
                <div class="layui-input-block">
                    <input type="checkbox" name="interest[code]" title="编程">
                    <input type="checkbox" name="interest[read]" title="读书" checked="checked">
                    <input type="checkbox" name="interest[sport]" title="运动">
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">性别</label>
                <div class="layui-input-block" id="edit-sex">
                    <input type="radio" name="sex" value="1" title="男">
                    <input type="radio" name="sex" value="2" title="女">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">管理员</label>
                <div class="layui-input-block" id="edit-is-admin">
                    <input type="checkbox" name="isAdmin" lay-skin="switch">
                </div>
            </div>
            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">个性签名</label>
                <div class="layui-input-block" id="edit-personalized-signature">
                    <textarea name="personalizedSignature" placeholder="请输入内容" class="layui-textarea"></textarea>
                </div>
            </div>


            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button class="layui-btn" lay-submit lay-filter="formDemo">立即提交</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>
        </form>

    </div>
</div>

<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
    <div class="layui-header" style="background-color: #009688;">
        <div class="layui-logo" style="background-color: #007d71;color: #fff;">项目管理系统</div>
        <ul class="layui-nav layui-layout-right">
            <li class="layui-nav-item">
                <a href="javascript:;" style="color: #fff;">
                    <img src="http://t.cn/RCzsdCq" class="layui-nav-img">
                    杨炜帆
                </a>
                <dl class="layui-nav-child">
                    <dd><a href="">基本资料</a></dd>
                    <dd><a href="">个人设置</a></dd>
                </dl>
            </li>
            <li class="layui-nav-item"><a href="" style="color: #fff;">退出</a></li>
        </ul>
    </div>

    <div class="layui-side">
        <div class="layui-side-scroll">
            <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
            <ul class="layui-nav layui-nav-tree">
                <li class="layui-nav-item layui-nav-itemed system-management">
                    <a class="" href="javascript:;">系统管理</a>
                    <ul class="layui-nav-child" id="tabHeader" lay-filter="side-tab">
                        <li><a href="#" lay-id="projectManagement">项目管理</a></li>
                        <li><a href="#" lay-id="userManagement">用户管理</a></li>
                        <li><a href="#" lay-id="teamManagement">团队管理</a></li>
                    </ul>
                </li>
                <li class="layui-nav-item">
                    <a href="javascript:;">帮助文档</a>
                </li>
                <li class="layui-nav-item"><a href="https://github.com/Winfans" target="_blank">Github</a></li>
                <li class="layui-nav-item"><a href="https://blog.csdn.net/qq1123642601" target="_blank">CSDN</a></li>
            </ul>
        </div>
    </div>

    <div class="layui-body">

        <div id="tabBody">


            <div class="tab-body-content" style="display: none;">
                <table class="layui-hide" id="project-table" lay-filter="project-filter">
                </table>

                <script type="text/html" id="project-left-toolbar">
                    <div class="layui-input-inline search-input">
                        <input type="text" name="title" placeholder="请输入项目名称" autocomplete="off"
                               class="layui-input">
                    </div>
                    <a class="layui-btn" lay-event="search">搜索</a>
                    <a class="layui-btn layui-btn-normal" lay-event="add">添加项目</a>
                    <a class="layui-btn layui-btn-danger" lay-event="del">批量删除</a>
                </script>

                <script type="text/html" id="project-row-toolbar">
                    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>
                    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
                    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
                </script>
            </div>

            <div class="tab-body-content" style="display: none;">
                <table class="layui-hide" id="userTable" lay-filter="user-filter">
                </table>

                <script type="text/html" id="left-demo">
                    <div class="layui-input-inline search-input">
                        <input type="text" name="title" placeholder="请输入用户名" autocomplete="off"
                               class="layui-input">
                    </div>
                    <a class="layui-btn" lay-event="search">搜索</a>
                    <a class="layui-btn layui-btn-normal" lay-event="add">添加用户</a>
                    <a class="layui-btn layui-btn-danger" lay-event="del">批量删除</a>
                </script>

                <script type="text/html" id="barDemo">
                    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>
                    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
                    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
                </script>
            </div>

            <div class="tab-body-content" style="display: none;">
                <table class="layui-hide" id="team-table" lay-filter="team-filter">
                </table>

                <script type="text/html" id="team-left-toolbar">
                    <div class="layui-input-inline search-input">
                        <input type="text" name="title" placeholder="请输入项目名" autocomplete="off"
                               class="layui-input">
                    </div>
                    <a class="layui-btn" lay-event="search">搜索</a>
                    <a class="layui-btn layui-btn-normal" lay-event="add">添加用户</a>
                    <a class="layui-btn layui-btn-danger" lay-event="del">批量删除</a>
                </script>

                <script type="text/html" id="team-row-toolbar">
                    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>
                    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
                    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
                </script>
            </div>

        </div>


    </div>

    <div class="layui-footer">
        <!-- 底部固定区域 -->
    </div>
</div>
<script src="../static/js/jquery-1.11.3.js"></script>
<script src="../static/layui/layui.all.js"></script>
<!--工具-->
<script src="../static/js/util.js"></script>
<!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
<!--[if lt IE 9]>
<script static="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
<script static="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
<script>
    //JavaScript代码区域
    !function () {
        var element = layui.element,
            laypage = layui.laypage, // 分页
            layer = layui.layer, // 弹层
            table = layui.table, // 表格
            form = layui.form, // 表单
            element = layui.element, // 动态操作
            upload = layui.upload, // 文件上传
            laydate = layui.laydate; // 时间


        // 用户table实例
        table.render({
            elem: '#userTable',
            url: 'findAllUserByPageAndLimit', // 数据接口
            parseData: function (res) { //res 即为原始返回的数据
                return {
                    "code": res.status, //解析接口状态
                    "count": res.total, //解析数据长度
                    "data": res.data //解析数据列表
                };
            },
            title: '用户表',
            page: {theme: '#009688'},// 开启分页
            toolbar: '#left-demo', // 开启工具栏，此处显示默认图标，可以自定义模板，详见文档
            cols: [
                [ // 表头
                    {type: 'checkbox', fixed: 'left'},
                    {field: 'userId', title: '编号', sort: true, fixed: 'left'},
                    {field: 'username', title: '用户名'},
                    {field: 'isAdmin', title: '权限', sort: true},
                    {fixed: 'right', width: 165, align: 'center', toolbar: '#barDemo'}
                ]
            ]
        });

        // 监听用户table头工具栏事件
        table.on('toolbar(user-filter)', function (obj) {
            var checkStatus = table.checkStatus(obj.config.id)
                , data = checkStatus.data; //获取选中的数据
            switch (obj.event) {
                case 'add':
                    layer.open({
                        type: 1,
                        title: "添加用户",
                        area: ['calc(100% - 200px)', 'calc(100% - 60px)'],
                        shade: 0,
                        offset: ['60px', '200px'],
                        shadeClose: false,
                        content: $('#addUser'),
                        yes: function (index, layero) {
                        },
                        closeBtn: 1,
                        btnAlign: 'c',
                        success: function (layero, index) {

                        },
                        cancel: function () {
                            layer.closeAll();
                            return false;
                        },
                        end: function () {
                            layer.closeAll();
                            location.reload();
                        }
                    });
                    break;
                case 'update':
                    if (data.length === 0) {
                        layer.msg('请选择一行');
                    } else if (data.length > 1) {
                        layer.msg('只能同时编辑一个');
                    } else {
                        layer.alert('编辑 [id]：' + checkStatus.data[0].id);
                    }
                    break;
                case 'delete':
                    if (data.length === 0) {
                        layer.msg('请选择一行');
                    } else {
                        layer.msg('删除');
                    }
                    break;
            }
            ;
        });

        //监听用户table行工具事件
        table.on('tool(user-filter)', function (obj) { // tool 是工具条事件名，user-filter 是 table 原始容器的属性 lay-filter="对应的值"
            var data = obj.data, // 获得当前行数据
                layEvent = obj.event; //获得 lay-event 对应的值

            var userId = data.userId;

            if (layEvent === 'detail') {
                layer.msg('查看操作');
            } else if (layEvent === 'del') {
                layer.confirm('求求你不要删除我行么？', {
                    btn: ['不行', '好吧'], // 可以无限个按钮
                    btn2: function () {
                        layer.msg('爱你', {icon: 6});
                    }
                }, function (index) {
                    obj.del(); // 删除对应行（tr）的DOM结构
                    layer.close(index);
                    // 向服务端发送删除指令
                    window.location.href = getRootPath() + "/admin/deleteUserByUserId?userId=" + obj.data.userId;
                });
            } else if (layEvent === 'edit') {

                $.get(getRootPath() + "/admin/findUserByUserId?userId=" + userId, function (data, status) {
                    if (status === "success") {
                        console.log(data);
                        $('#edit-username').attr("value", data.username);
                        if (data.headPortrait) {
                            $('#edit-head-portrait').attr('src', data.headPortrait).css('display', 'block');
                        } else {
                            $('#edit-head-portrait-upload').css('display', 'block');
                        }
                        $('#edit-password').attr('value', data.password);
                        $('#edit-phone').attr('value', data.phone);
                        $('#edit-city > option').each(function (index, ele) {
                            if (data.city && $(ele).attr('value') === data.city) {
                                $(ele).attr('selected', 'selected')
                            } else {
                                $(ele).removeAttr('selected')
                            }
                        });

                        $('#edit-sex > input').each(function (index, ele) {
                            if (data.sex && $(ele).attr('value') === String(data.sex)) {
                                $(ele).attr('checked', 'checked')
                            } else {
                                $(ele).removeAttr('checked')
                            }
                        });
                        $('#edit-personalized-signature').text(data.personalizedSignature);

                    }
                });

                layer.open({
                    type: 1,
                    title: "编辑用户",
                    area: ['calc(100% - 200px)', 'calc(100% - 60px)'],
                    shade: 0,
                    offset: ['60px', '200px'],
                    shadeClose: false,
                    content: $('#editUser'),
                    yes: function (index, layero) {
                    },
                    closeBtn: 1,
                    btnAlign: 'c',
                    success: function (layero, index) {

                    },
                    cancel: function () {

                        // layer.open({
                        //     type: 1,
                        //     title: false, //不显示标题栏
                        //     closeBtn: false,
                        //     area: '300px;',
                        //     shade: 0.8,
                        //     btn: ['关闭它吧', '我想一下'], // id: 'LAY_layuipro' //设定一个id，防止重复弹出
                        //     yes: function () {
                        //         // $('#edit-city > option').each(function (index, ele) {
                        //         //     $(ele).removeAttr('selected')
                        //         // });
                        //         // $('#edit-sex > input').each(function (index, ele) {
                        //         //     $(ele).removeAttr('checked')
                        //         // });
                        //         layer.closeAll();
                        //     },
                        //     btnAlign: 'c',
                        //     moveType: 1,//拖拽模式，0或者1
                        //     content: '<div style="padding: 50px; line-height: 22px; background-color: #393D49; color: #fff; font-weight: 300;text-align:center;font-size:20px;">确定关闭吗?</div>'
                        // });

                        layer.closeAll();

                    },
                    end: function () {
                        layer.closeAll();
                        location.reload();
                    }
                });
            }
        });

        // 项目管理table
        table.render({
            elem: '#project-table',
            url: 'findAllProjectByPageAndLimitServlet', // 数据接口
            parseData: function (res) { //res 即为原始返回的数据
                return {
                    "code": res.status, //解析接口状态
                    "count": res.total, //解析数据长度
                    "data": res.data //解析数据列表
                };
            },
            title: '项目表',
            page: {theme: '#009688'},// 开启分页
            toolbar: '#project-left-toolbar', // 开启工具栏，此处显示默认图标，可以自定义模板，详见文档
            cols: [
                [ // 表头
                    {type: 'checkbox', fixed: 'left'},
                    {field: 'projectId', title: '编号', sort: true, fixed: 'left'},
                    {field: 'projectName', title: '用户名'},
                    {field: 'creator', title: '创建人', sort: true},
                    {field: 'leader', title: '负责人', sort: true},
                    {field: 'totalMoney', title: '总金额'},
                    {field: 'status', title: '状态'},
                    {fixed: 'right', width: 165, align: 'center', toolbar: '#project-row-toolbar'}
                ]
            ]
        });

        // 监听项目table头工具栏事件
        table.on('toolbar(project-filter)', function (obj) {
            var checkStatus = table.checkStatus(obj.config.id)
                , data = checkStatus.data; //获取选中的数据
            switch (obj.event) {
                case 'add':

                    $('#add-project-userId').attr('value', 205);
                    layer.open({
                        type: 1,
                        title: "添加项目",
                        area: ['calc(100% - 200px)', 'calc(100% - 60px)'],
                        shade: 0,
                        offset: ['60px', '200px'],
                        shadeClose: false,
                        content: $('#add-project'),
                        yes: function (index, layero) {
                        },
                        closeBtn: 1,
                        btnAlign: 'c',
                        success: function (layero, index) {

                        },
                        cancel: function () {
                            layer.closeAll();
                            return false;
                        },
                        end: function () {
                            layer.closeAll();
                            location.reload();
                        }
                    });
                    break;
                case 'delete':
                    if (data.length === 0) {
                        layer.msg('请选择一行');
                    } else {
                        layer.msg('删除');
                    }
                    break;
            }
        });

        //监听用户table行工具事件
        table.on('tool(project-filter)', function (obj) { // tool 是工具条事件名，user-filter 是 table 原始容器的属性 lay-filter="对应的值"
            var data = obj.data, // 获得当前行数据
                layEvent = obj.event; //获得 lay-event 对应的值

            if (layEvent === 'detail') {

                var $baseInfoTable = $('#view-project .view-project-wrappper .layui-table.base-info-table tbody').eq(0);
                console.log($baseInfoTable);

                $.get("findProjectByProjectId?projectId=" + data.projectId, function (res) {
                    $baseInfoTable.html(" <tr>\n" +
                        "                <th>编号</th>\n" +
                        "                <td>" + res.projectId + "</td>\n" +
                        "                <th>项目名称</th>\n" +
                        "                <td>" + res.projectName + "</td>\n" +
                        "            </tr>\n" +
                        "            <tr>\n" +
                        "                <th>项目周期</th>\n" +
                        "                <td>" + res.planTime + "</td>\n" +
                        "                <th>总金额</th>\n" +
                        "                <td>" + res.totalMoney + "</td>\n" +
                        "            </tr>\n" +
                        "            <tr>\n" +
                        "                <th>创建人</th>\n" +
                        "                <td>" + res.creator + "</td>\n" +
                        "                <th>负责人</th>\n" +
                        "                <td>" + res.leader + "</td>\n" +
                        "            </tr>\n" +
                        "            <tr>\n" +
                        "                <th>创建时间</th>\n" +
                        "                <td>" + res.createTime + "</td>\n" +
                        "                <th>更新时间</th>\n" +
                        "                <td>" + res.updateTime + "</td>\n" +
                        "            </tr>\n" +
                        "            <tr>\n" +
                        "                <th>计划开始时间</th>\n" +
                        "                <td>" + res.planStartTime + "</td>\n" +
                        "                <th>计划结束时间</th>\n" +
                        "                <td>" + res.planEndTime + "</td>\n" +
                        "            </tr>\n" +
                        "            <tr>\n" +
                        "            </tr>\n" +
                        "            <tr>\n" +
                        "                <th>项目内容</th>\n" +
                        "                <td colspan=\"4\">" + res.content + "</td>\n" +
                        "            </tr>")
                });

                layer.open({
                    type: 1,
                    title: "详情信息",
                    area: ['calc(100% - 200px)', 'calc(100% - 60px)'],
                    shade: 0,
                    offset: ['60px', '200px'],
                    shadeClose: false,
                    content: $('#view-project'),
                    yes: function (index, layero) {
                    },
                    closeBtn: 1,
                    btnAlign: 'c',
                    success: function (layero, index) {

                    },
                    cancel: function () {
                        layer.closeAll();
                        return false;
                    },
                    end: function () {
                        layer.closeAll();
                    }
                });
            } else if (layEvent === 'del') {
                layer.confirm('求求你不要删除我行么？', {
                    btn: ['不行', '好吧'], // 可以无限个按钮
                    btn2: function () {
                        layer.msg('爱你', {icon: 6});
                    }
                }, function (index) {
                    obj.del(); // 删除对应行（tr）的DOM结构
                    layer.close(index);
                    // 向服务端发送删除指令
                    window.location.href = getRootPath() + "/admin/deleteUserByUserId?userId=" + obj.data.userId;
                });
            } else if (layEvent === 'edit') {

                $.get(getRootPath() + "/admin/findUserByUserId?userId=" + userId, function (data, status) {
                    if (status === "success") {
                        console.log(data);
                        $('#edit-username').attr("value", data.username);
                        if (data.headPortrait) {
                            $('#edit-head-portrait').attr('src', data.headPortrait).css('display', 'block');
                        } else {
                            $('#edit-head-portrait-upload').css('display', 'block');
                        }
                        $('#edit-password').attr('value', data.password);
                        $('#edit-phone').attr('value', data.phone);
                        $('#edit-city > option').each(function (index, ele) {
                            if (data.city && $(ele).attr('value') === data.city) {
                                $(ele).attr('selected', 'selected')
                            } else {
                                $(ele).removeAttr('selected')
                            }
                        });

                        $('#edit-sex > input').each(function (index, ele) {
                            if (data.sex && $(ele).attr('value') === String(data.sex)) {
                                $(ele).attr('checked', 'checked')
                            } else {
                                $(ele).removeAttr('checked')
                            }
                        });
                        $('#edit-personalized-signature').text(data.personalizedSignature);

                    }
                });

                layer.open({
                    type: 1,
                    title: "编辑用户",
                    area: ['calc(100% - 200px)', 'calc(100% - 60px)'],
                    shade: 0,
                    offset: ['60px', '200px'],
                    shadeClose: false,
                    content: $('#editUser'),
                    yes: function (index, layero) {
                    },
                    closeBtn: 1,
                    btnAlign: 'c',
                    success: function (layero, index) {

                    },
                    cancel: function () {

                        // layer.open({
                        //     type: 1,
                        //     title: false, //不显示标题栏
                        //     closeBtn: false,
                        //     area: '300px;',
                        //     shade: 0.8,
                        //     btn: ['关闭它吧', '我想一下'], // id: 'LAY_layuipro' //设定一个id，防止重复弹出
                        //     yes: function () {
                        //         // $('#edit-city > option').each(function (index, ele) {
                        //         //     $(ele).removeAttr('selected')
                        //         // });
                        //         // $('#edit-sex > input').each(function (index, ele) {
                        //         //     $(ele).removeAttr('checked')
                        //         // });
                        //         layer.closeAll();
                        //     },
                        //     btnAlign: 'c',
                        //     moveType: 1,//拖拽模式，0或者1
                        //     content: '<div style="padding: 50px; line-height: 22px; background-color: #393D49; color: #fff; font-weight: 300;text-align:center;font-size:20px;">确定关闭吗?</div>'
                        // });

                        layer.closeAll();

                    },
                    end: function () {
                        layer.closeAll();
                        location.reload();
                    }
                });
            }
        });


        // 团队管理table
        table.render({
            elem: '#team-table',
            url: 'findAllUserByPageAndLimit', // 数据接口
            parseData: function (res) { //res 即为原始返回的数据
                return {
                    "code": res.status, //解析接口状态
                    "count": res.total, //解析数据长度
                    "data": res.data //解析数据列表
                };
            },
            title: '项目表',
            page: {theme: '#009688'},// 开启分页
            toolbar: '#team-left-toolbar', // 开启工具栏，此处显示默认图标，可以自定义模板，详见文档
            cols: [
                [ // 表头
                    {type: 'checkbox', fixed: 'left'},
                    {field: 'userId', title: '编号', sort: true, fixed: 'left'},
                    {field: 'username', title: '用户名'},
                    {field: 'isAdmin', title: '权限', sort: true},
                    {fixed: 'right', width: 165, align: 'center', toolbar: '#team-row-toolbar'}
                ]
            ]
        });


        //添加用户的上传文件实例
        upload.render({
            elem: '#head-portrait-upload' //绑定元素
            , url: 'http://www.wffanshao.top/office-api/upload/image', //上传接口
            progress: function (n) {
                var percent = n + '%'; //获取进度百分比
                element.progress('demo', percent); //可配合 layui 进度条元素使用
            }
            , done: function (res) {
                //上传完毕回调
                $('#head-portrait-upload').css('display', "none");
                $('#head-portrait').css('display', "block");
                $('#head-portrait').attr('src', res.data);
                $('#head-portrait-input').attr('value', res.data);
            }
            , error: function () {
                //请求异常回调
            }
        });

        //编辑用户的上传文件实例
        upload.render({
            elem: '#edit-head-portrait-upload' //绑定元素
            , url: 'http://www.wffanshao.top/office-api/upload/image', //上传接口
            progress: function (n) {
                var percent = n + '%'; //获取进度百分比
                element.progress('demo', percent); //可配合 layui 进度条元素使用
            }
            , done: function (res) {
                //上传完毕回调
                $('#edit-head-portrait-upload').css('display', "none");
                $('#edit-head-portrait').css('display', "block").attr('src', res.data);
                $('#edit-head-portrait-input').attr('value', res.data);
            }
            , error: function () {
                //请求异常回调
            }
        });

        // tab
        element.tab({
            headerElem: '#tabHeader > li', // 指定tab头元素项
            bodyElem: '#tabBody > .tab-body-content' // 指定tab主体元素项
        });

        //获取hash来切换选项卡，假设当前地址的hash为lay-id对应的值
        // var layid = location.hash.replace(/^#side-tab=/, '');
        // element.tabChange('side-tab', layid); // 假设当前地址为：http://a.com#test1=222，那么选项卡会自动切换到“发送消息”这一项


        //监听Tab切换，以改变地址hash值
        element.on('tab(side-tab)', function(data){
            console.log(this); //当前Tab标题所在的原始DOM元素
            console.log(data.index); //得到当前Tab的所在下标
            console.log(data.elem); //得到当前的Tab大容器
            location.hash = 'side-tab='+ this.getAttribute('lay-id');
        });

        // 计划开始时间laydate
        laydate.render({
            elem: '#add-plan-start-time', //指定元素
            type: 'datetime'
        });

        // 计划结束时间
        laydate.render({
            elem: '#add-plan-end-time', //指定元素
            type: 'datetime'
        });


    }();
</script>
</body>
</html>
